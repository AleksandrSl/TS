#!/bin/bash
# Copyright (C) 2016 Ion Torrent Systems, Inc. All Rights Reserved
set -e

if [[ "$(lsb_release -cs)" = "lucid" ]]; then
    #---------------------------------------------------------------------
    # Replace URL in all list files + ts_params file
    #---------------------------------------------------------------------
    # Find all list files in /etc/apt directory
    listfiles=$(find /etc/apt -name \*.list)
    # Append the ts_params file to the list
    if [[ -r "/usr/share/ion-tsconfig/ts_params" ]]; then
        listfiles=($listfiles "/usr/share/ion-tsconfig/ts_params")
    fi

    old_urls=(
    us.archive.ubuntu.com
    security.ubuntu.com
    )

    for url in ${old_urls[@]}; do
        for file in ${listfiles[@]}; do
            sed -i "s/$url/old-releases.ubuntu.com/g" $file
        done
    done

else
    echo "No URL change necessary for codename $(lsb_release -cs)"
fi

exit

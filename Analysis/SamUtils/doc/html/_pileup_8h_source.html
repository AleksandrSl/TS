<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SamUtils: types/Pileup.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="300px-Lightning_storm_over_Boston_-_NOAA.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SamUtils</div>
   <div id="projectbrief">Utility classes for working with SAM/BAM files.  Also provides some basic quality utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_pileup_8h.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">types/Pileup.h</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright (C) 2011 Ion Torrent Systems, Inc. All Rights Reserved */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">/*</span>
<a name="l00005"></a>00005 <span class="comment"> *  PileupFactory.h</span>
<a name="l00006"></a>00006 <span class="comment"> *  SamUtils</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *  Created by Michael Lyons on 3/15/11.</span>
<a name="l00009"></a>00009 <span class="comment"> *  Copyright 2011 Life Technologies. All rights reserved.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> */</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#ifndef PILEUP_H</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define PILEUP_H</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;tr1/memory&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;tr1/unordered_map&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;BAMRead.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;../BAMUtils.h&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;samutils_types.h&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">using namespace </span>std;
<a name="l00029"></a>00029  
<a name="l00039"></a><a class="code" href="class_pileup.html">00039</a> <span class="keyword">class </span><a class="code" href="class_pileup.html">Pileup</a> {
<a name="l00040"></a>00040 <span class="keyword">public</span>:
<a name="l00041"></a>00041  
<a name="l00045"></a><a class="code" href="class_pileup.html#ab24ad8d1adc85141d279fa82645f9d67">00045</a>  <a class="code" href="class_pileup.html#ab24ad8d1adc85141d279fa82645f9d67">Pileup</a>(): _tid(-1), _pos(-1), _num_reads(0),_debug(false), all_covered(false) { 
<a name="l00046"></a>00046   
<a name="l00047"></a>00047  } 
<a name="l00060"></a><a class="code" href="class_pileup.html#af7a208f2f224582260aa4780f05156be">00060</a>  <a class="code" href="class_pileup.html#af7a208f2f224582260aa4780f05156be">Pileup</a>(<span class="keywordtype">int</span> tid, <span class="keywordtype">int</span> pos, vector&lt;int&gt;&amp; phreds ) : _tid(tid), _pos(pos),_num_reads(0),_debug(false), all_covered(false) {
<a name="l00061"></a>00061   q_scores = phreds;
<a name="l00062"></a>00062   q_cov = std::tr1::unordered_map&lt;int, coord_t&gt;(phreds.size());
<a name="l00063"></a>00063   <span class="keywordflow">for</span> (vector&lt;int&gt;::iterator i = q_scores.begin(); i != q_scores.end(); ++i) {
<a name="l00064"></a>00064    
<a name="l00065"></a>00065    q_cov[ *i ] = 0;
<a name="l00066"></a>00066   }
<a name="l00067"></a>00067     
<a name="l00068"></a>00068  }
<a name="l00069"></a>00069  
<a name="l00079"></a><a class="code" href="class_pileup.html#aa12195e46d05c2ef4bcd5c455af2fa27">00079</a>  <a class="code" href="class_pileup.html#aa12195e46d05c2ef4bcd5c455af2fa27">Pileup</a>(<span class="keywordtype">int</span> tid, <span class="keywordtype">int</span> pos, vector&lt;int&gt;&amp; phreds, <a class="code" href="class_b_a_m_utils.html">BAMUtils</a>* _p ) : _tid(tid), _pos(pos),_num_reads(0),_debug(false), all_covered(false) {
<a name="l00080"></a>00080   _debug = <span class="keyword">false</span>;
<a name="l00081"></a>00081   q_scores = phreds;
<a name="l00082"></a>00082   q_cov = std::tr1::unordered_map&lt;int, coord_t&gt;(phreds.size());
<a name="l00083"></a>00083   <span class="keywordflow">for</span> (vector&lt;int&gt;::iterator i = q_scores.begin(); i != q_scores.end(); ++i) {
<a name="l00084"></a>00084    
<a name="l00085"></a>00085    q_cov[ *i ] = 0;
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087   insert_util(_p);
<a name="l00088"></a>00088   
<a name="l00089"></a>00089  }
<a name="l00090"></a>00090  
<a name="l00091"></a>00091  
<a name="l00092"></a>00092  
<a name="l00098"></a><a class="code" href="class_pileup.html#a0ed467fc2ce855eee7a61b83059d8877">00098</a>  <a class="code" href="class_pileup.html">Pileup</a>(<a class="code" href="class_pileup.html">Pileup</a> <span class="keyword">const</span>&amp; other) : _tid(other._tid), _pos(other._pos), _num_reads(other._num_reads), 
<a name="l00099"></a>00099  q_cov(other.q_cov), q_scores(other.q_scores), _utils(other._utils),_debug(other._debug),all_covered(other.all_covered)
<a name="l00100"></a>00100  {
<a name="l00101"></a>00101  }
<a name="l00102"></a>00102  
<a name="l00103"></a>00103  
<a name="l00110"></a><a class="code" href="class_pileup.html#a4c65041c58658064b3de1ef715990fb1">00110</a>  <a class="code" href="class_pileup.html">Pileup</a>&amp; <a class="code" href="class_pileup.html#a4c65041c58658064b3de1ef715990fb1">operator=</a>(<a class="code" href="class_pileup.html">Pileup</a> that) {
<a name="l00111"></a>00111    swap(*<span class="keyword">this</span>, that);
<a name="l00112"></a>00112   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00113"></a>00113  }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115  
<a name="l00122"></a><a class="code" href="class_pileup.html#a5ef3f3c48d209a9297fa5d3edcc64918">00122</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup.html#a5ef3f3c48d209a9297fa5d3edcc64918">insert_util</a>(<a class="code" href="class_b_a_m_utils.html">BAMUtils</a>* _p) {
<a name="l00123"></a>00123   _num_reads++;
<a name="l00124"></a>00124   <span class="keywordflow">for</span> (vector&lt;int&gt;::size_type i = 0; i &lt; q_scores.size(); i++) {
<a name="l00125"></a>00125    <span class="keywordflow">if</span> (q_cov[ q_scores[i] ] != 0) {
<a name="l00126"></a>00126     all_covered = <span class="keyword">true</span>;
<a name="l00127"></a>00127     <span class="keywordflow">continue</span>;
<a name="l00128"></a>00128    }
<a name="l00129"></a>00129    <span class="keywordflow">else</span> {
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="keywordflow">if</span>(_p-&gt;<a class="code" href="class_b_a_m_utils.html#a70a4548a475423dd0145105acffaea31">is_pos_covered</a>(_pos, q_scores[i])) {
<a name="l00132"></a>00132 
<a name="l00133"></a>00133      q_cov[ q_scores[i] ]++;
<a name="l00134"></a>00134      
<a name="l00135"></a>00135     } <span class="keywordflow">else</span> {
<a name="l00136"></a>00136      all_covered = <span class="keyword">false</span>;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     
<a name="l00140"></a>00140    }
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142   
<a name="l00143"></a>00143  }
<a name="l00144"></a>00144  
<a name="l00150"></a><a class="code" href="class_pileup.html#a54cb72913b0fde34d9a781f3f9a9a2d9">00150</a>  <span class="keywordtype">int</span> <a class="code" href="class_pileup.html#a54cb72913b0fde34d9a781f3f9a9a2d9">get_tid</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _tid; }
<a name="l00156"></a><a class="code" href="class_pileup.html#a7c2e7c25ed33a0e62e8de528218b6107">00156</a>  coord_t <a class="code" href="class_pileup.html#a7c2e7c25ed33a0e62e8de528218b6107">get_pos</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _pos; }
<a name="l00165"></a><a class="code" href="class_pileup.html#a5fd72bbb7048f642b86bb668ae011124">00165</a>  <span class="keywordtype">long</span> <a class="code" href="class_pileup.html#a5fd72bbb7048f642b86bb668ae011124">get_num_reads</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _num_reads; }
<a name="l00172"></a><a class="code" href="class_pileup.html#ab83a8e4e308f82d44034ee8fbdea4859">00172</a>  <span class="keywordtype">bool</span> <a class="code" href="class_pileup.html#ab83a8e4e308f82d44034ee8fbdea4859">is_covered</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> all_covered; }
<a name="l00180"></a><a class="code" href="class_pileup.html#a30556727363178d131bfe8648a18c77c">00180</a>  <span class="keywordtype">int</span> <a class="code" href="class_pileup.html#a30556727363178d131bfe8648a18c77c">get_phred_cov</a>(<span class="keywordtype">int</span> phred) {
<a name="l00181"></a>00181  
<a name="l00182"></a>00182   <span class="keywordflow">if</span> (q_cov.count(phred) &gt; 0) {
<a name="l00183"></a>00183    <span class="keywordflow">return</span> q_cov[phred];
<a name="l00184"></a>00184   } <span class="keywordflow">else</span> {
<a name="l00185"></a>00185    <span class="keywordflow">return</span> 0;
<a name="l00186"></a>00186   }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188  }
<a name="l00189"></a>00189  
<a name="l00190"></a>00190  
<a name="l00191"></a>00191    
<a name="l00192"></a>00192  ~<a class="code" href="class_pileup.html">Pileup</a>() {
<a name="l00193"></a>00193   <span class="comment">/*_utils.clear();</span>
<a name="l00194"></a>00194 <span class="comment">  q_cov.clear();</span>
<a name="l00195"></a>00195 <span class="comment">  q_scores.clear();*/</span>
<a name="l00196"></a>00196   
<a name="l00197"></a>00197  }
<a name="l00198"></a>00198  
<a name="l00199"></a>00199 <span class="keyword">private</span>:
<a name="l00200"></a>00200  <span class="keywordtype">void</span> swap(<a class="code" href="class_pileup.html">Pileup</a>&amp; first, <a class="code" href="class_pileup.html">Pileup</a>&amp; second) {
<a name="l00201"></a>00201   
<a name="l00202"></a>00202   <span class="keyword">using</span> std::swap; <span class="comment">//enables ADL</span>
<a name="l00203"></a>00203   swap(first._tid, second._tid);
<a name="l00204"></a>00204   swap(first._pos, second._pos);
<a name="l00205"></a>00205   swap(first._num_reads, second._num_reads);
<a name="l00206"></a>00206   swap(first.q_cov, second.q_cov);
<a name="l00207"></a>00207   swap(first.q_scores, second.q_scores);
<a name="l00208"></a>00208   swap(first._utils, second._utils);
<a name="l00209"></a>00209   swap(first._debug, second._debug);
<a name="l00210"></a>00210   swap(first.all_covered, second.all_covered);
<a name="l00211"></a>00211   
<a name="l00212"></a>00212   
<a name="l00213"></a>00213  }
<a name="l00214"></a>00214  
<a name="l00215"></a>00215   
<a name="l00216"></a>00216  <span class="keywordtype">int</span>   _tid;
<a name="l00217"></a>00217  coord_t  _pos;
<a name="l00218"></a>00218  <span class="keywordtype">long</span>  _num_reads;
<a name="l00219"></a>00219  std::tr1::unordered_map&lt;int, coord_t&gt; q_cov;
<a name="l00220"></a>00220  std::vector&lt;int&gt; q_scores;
<a name="l00221"></a>00221  std::list&lt;BAMUtils* &gt; _utils;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223  <span class="keywordtype">bool</span>  _debug;
<a name="l00224"></a>00224  <span class="keywordtype">bool</span>  all_covered; <span class="comment">// this is a speed thing.  not required</span>
<a name="l00225"></a>00225  
<a name="l00226"></a>00226 };
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00245"></a><a class="code" href="class_pileup_factory.html">00245</a> <span class="keyword">class </span><a class="code" href="class_pileup_factory.html">PileupFactory</a> {
<a name="l00246"></a>00246  
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="keyword">public</span>:
<a name="l00249"></a><a class="code" href="class_pileup_factory.html#ae4c0b96c035216ba005467e2d5fc3397">00249</a>  <span class="keyword">typedef</span> std::tr1::unordered_map&lt;int, Pileup&gt; <a class="code" href="class_pileup_factory.html#ae4c0b96c035216ba005467e2d5fc3397">pileup_container_t</a>; 
<a name="l00254"></a><a class="code" href="class_pileup_factory.html#a0f382d75621a4b7d6cc5fd0c1d749e5e">00254</a>  <a class="code" href="class_pileup_factory.html#a0f382d75621a4b7d6cc5fd0c1d749e5e">PileupFactory</a>():_debug(false),_tid(-1), _start_pos(-1), _end_pos(-1) {}
<a name="l00255"></a>00255  
<a name="l00264"></a><a class="code" href="class_pileup_factory.html#ae8550e54b25cea368a5cc8ba618a80e5">00264</a>  <a class="code" href="class_pileup_factory.html#ae8550e54b25cea368a5cc8ba618a80e5">PileupFactory</a>(<span class="keywordtype">int</span> tid, <span class="keywordtype">int</span> start_pos, <span class="keywordtype">int</span> end_pos) :_debug(false), _tid(tid),_start_pos(start_pos), _end_pos(end_pos) { 
<a name="l00265"></a>00265   
<a name="l00266"></a>00266   _phreds.push_back(7);
<a name="l00267"></a>00267   _phreds.push_back(10);
<a name="l00268"></a>00268   _phreds.push_back(17);
<a name="l00269"></a>00269   _phreds.push_back(20);
<a name="l00270"></a>00270   _phreds.push_back(47);
<a name="l00271"></a>00271   
<a name="l00272"></a>00272  }
<a name="l00283"></a><a class="code" href="class_pileup_factory.html#acbc56060b1f13b7d1cdb4acba5b6c451">00283</a>  <a class="code" href="class_pileup_factory.html#acbc56060b1f13b7d1cdb4acba5b6c451">PileupFactory</a>(<span class="keywordtype">int</span> tid, <span class="keywordtype">int</span> start_pos, <span class="keywordtype">int</span> end_pos, vector&lt;int&gt;&amp; phreds) :_debug(false), _tid(tid),_start_pos(start_pos), _end_pos(end_pos), _phreds(phreds) { 
<a name="l00284"></a>00284   
<a name="l00285"></a>00285   
<a name="l00286"></a>00286  }
<a name="l00287"></a>00287  
<a name="l00288"></a>00288  
<a name="l00307"></a><a class="code" href="class_pileup_factory.html#a2b95a68ddb7f2bcd6d828e6733cca118">00307</a>  <a class="code" href="class_pileup_factory.html#a2b95a68ddb7f2bcd6d828e6733cca118">PileupFactory</a>(<span class="keywordtype">int</span> tid, <span class="keywordtype">int</span> start_pos, <span class="keywordtype">int</span> end_pos, vector&lt;int&gt;&amp; phreds, std::vector&lt;BAMRead&gt;&amp; the_overlaps) :_debug(false), _tid(tid),_start_pos(start_pos), _end_pos(end_pos), _phreds(phreds) { 
<a name="l00308"></a>00308   _debug = <span class="keyword">false</span>; 
<a name="l00309"></a>00309   
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   set_overlap_reads(the_overlaps);
<a name="l00312"></a>00312   
<a name="l00313"></a>00313  }
<a name="l00314"></a>00314  
<a name="l00315"></a>00315  
<a name="l00322"></a><a class="code" href="class_pileup_factory.html#a34aafd5bef78d8b1cf6ed40cc7d07e70">00322</a>  <a class="code" href="class_pileup_factory.html">PileupFactory</a>(<a class="code" href="class_pileup_factory.html">PileupFactory</a> <span class="keyword">const</span>&amp; other):
<a name="l00323"></a>00323  _debug(other._debug), _tid(other._tid), _start_pos(other._start_pos), _end_pos(other._end_pos), _phreds(other._phreds),
<a name="l00324"></a>00324  positional_cov(other.positional_cov), overlap_reads(other.overlap_reads), overlap_utils(other.overlap_utils)
<a name="l00325"></a>00325  
<a name="l00326"></a>00326  {
<a name="l00327"></a>00327    
<a name="l00328"></a>00328   <span class="comment">//cerr &lt;&lt; &quot;[PileupFactory] copy ctor&quot; &lt;&lt; endl;</span>
<a name="l00329"></a>00329  }
<a name="l00330"></a>00330  
<a name="l00331"></a>00331  
<a name="l00335"></a><a class="code" href="class_pileup_factory.html#a152705c18ce0fb952bf89c0783752bca">00335</a>  <a class="code" href="class_pileup_factory.html">PileupFactory</a>&amp; <a class="code" href="class_pileup_factory.html#a152705c18ce0fb952bf89c0783752bca">operator=</a>(<a class="code" href="class_pileup_factory.html">PileupFactory</a> that) {
<a name="l00336"></a>00336   swap(*<span class="keyword">this</span>, that);
<a name="l00337"></a>00337   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00338"></a>00338   
<a name="l00339"></a>00339  }
<a name="l00340"></a>00340  
<a name="l00344"></a><a class="code" href="class_pileup_factory.html#a227de38502522bf50b855d1a8b7f5a6f">00344</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory.html#a227de38502522bf50b855d1a8b7f5a6f">init_factory</a>() {
<a name="l00345"></a>00345   <span class="keywordflow">if</span> (((_end_pos - _start_pos) &gt; 1) &amp;&amp; ((_end_pos - _start_pos) &lt; 1000000)) {<span class="comment">//limit to reduce mem on low coverage runs</span>
<a name="l00346"></a>00346    positional_cov.rehash((_end_pos - _start_pos));
<a name="l00347"></a>00347   } 
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   
<a name="l00350"></a>00350  }
<a name="l00351"></a>00351   
<a name="l00352"></a>00352   
<a name="l00359"></a><a class="code" href="class_pileup_factory.html#a1920bc4147b24073bf616ffb29f7ab5c">00359</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory.html#a1920bc4147b24073bf616ffb29f7ab5c">insert_util</a>(<a class="code" href="class_b_a_m_utils.html">BAMUtils</a>&amp; util) {
<a name="l00360"></a>00360   
<a name="l00361"></a>00361    
<a name="l00362"></a>00362   <a class="code" href="class_b_a_m_read.html">BAMRead</a>&amp; align = util.<a class="code" href="class_b_a_m_utils.html#af76ec0920e92a73a8c60e898330e62f6">get_bamread</a>();
<a name="l00363"></a>00363   <a class="code" href="class_b_a_m_utils.html">BAMUtils</a>* _ptr = &amp;util;
<a name="l00364"></a>00364   <span class="keywordtype">int</span> read_start = align.<a class="code" href="class_b_a_m_read.html#ad0eabedce37189ad45ba29eadbee550a">get_pos</a>();
<a name="l00365"></a>00365   <span class="keywordtype">int</span> calend = align.<a class="code" href="class_b_a_m_read.html#a2bd07073d526f48485c2ac034572b3c4">calend</a>();
<a name="l00366"></a>00366   
<a name="l00367"></a>00367   <span class="keywordtype">int</span> loop_start = 0;
<a name="l00368"></a>00368   
<a name="l00369"></a>00369   <span class="keywordflow">if</span> (read_start &gt;= _start_pos) {
<a name="l00370"></a>00370    loop_start = read_start;
<a name="l00371"></a>00371   } <span class="keywordflow">else</span> {
<a name="l00372"></a>00372    loop_start = _start_pos;
<a name="l00373"></a>00373   }
<a name="l00374"></a>00374   
<a name="l00375"></a>00375   
<a name="l00376"></a>00376   <span class="keywordtype">int</span> loop_end = 0;
<a name="l00377"></a>00377   <span class="keywordflow">if</span> (calend &gt; _end_pos) {
<a name="l00378"></a>00378    loop_end = _end_pos;
<a name="l00379"></a>00379   } <span class="keywordflow">else</span> {
<a name="l00380"></a>00380    loop_end = calend;
<a name="l00381"></a>00381   }
<a name="l00382"></a>00382   
<a name="l00383"></a>00383   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = loop_start; j &lt;= loop_end; j++) {
<a name="l00384"></a>00384    pileup_container_t::iterator uom_itr = positional_cov.find(j);
<a name="l00385"></a>00385    <span class="keywordflow">if</span> (uom_itr != positional_cov.end()) {
<a name="l00386"></a>00386     <span class="keywordflow">if</span> (uom_itr-&gt;second.is_covered()) {
<a name="l00387"></a>00387      <span class="keywordflow">continue</span>;
<a name="l00388"></a>00388     } <span class="keywordflow">else</span> {
<a name="l00389"></a>00389      uom_itr-&gt;second.insert_util(_ptr);
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392    } <span class="keywordflow">else</span> {
<a name="l00393"></a>00393     positional_cov[j] = <a class="code" href="class_pileup.html">Pileup</a>(_tid,j, _phreds, _ptr);
<a name="l00394"></a>00394    }
<a name="l00395"></a>00395    
<a name="l00396"></a>00396    
<a name="l00397"></a>00397    
<a name="l00398"></a>00398   
<a name="l00399"></a>00399 
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401   
<a name="l00402"></a>00402   
<a name="l00403"></a>00403  }
<a name="l00404"></a>00404  
<a name="l00414"></a><a class="code" href="class_pileup_factory.html#ad61e4f1bfe0ce99004d5e07e0697d0de">00414</a>  <a class="code" href="class_pileup.html">Pileup</a> <a class="code" href="class_pileup_factory.html#ad61e4f1bfe0ce99004d5e07e0697d0de">get_pileup</a>(<span class="keywordtype">int</span> pos_in_genome) {
<a name="l00415"></a>00415   <span class="comment">//</span>
<a name="l00416"></a>00416   
<a name="l00417"></a>00417   <span class="keywordflow">if</span> (positional_cov.count(pos_in_genome) &gt; 0) {
<a name="l00418"></a>00418    <span class="keywordflow">return</span> positional_cov[pos_in_genome];
<a name="l00419"></a>00419   } <span class="keywordflow">else</span> {
<a name="l00420"></a>00420    <span class="keywordflow">return</span> <a class="code" href="class_pileup.html">Pileup</a>();
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   
<a name="l00426"></a>00426  }
<a name="l00427"></a>00427  
<a name="l00436"></a><a class="code" href="class_pileup_factory.html#aa0f1f6e20f54688154b710a63b41d457">00436</a>  <span class="keywordtype">bool</span> <a class="code" href="class_pileup_factory.html#aa0f1f6e20f54688154b710a63b41d457">is_pos_covered</a>(<span class="keywordtype">int</span> pos_in_genome, <span class="keywordtype">int</span> phred_score) {
<a name="l00437"></a>00437   
<a name="l00438"></a>00438   <span class="keywordflow">if</span> (_debug) cerr &lt;&lt; <span class="stringliteral">&quot;[PileupFactory - is_pos_covered()] positional_cov.size(): &quot;</span> &lt;&lt; positional_cov.size() &lt;&lt; endl;
<a name="l00439"></a>00439    
<a name="l00440"></a>00440    <span class="keywordflow">if</span> (pos_in_genome &gt;= _start_pos &amp;&amp; pos_in_genome &lt;= _end_pos) {
<a name="l00441"></a>00441     <span class="comment">//int _index = pos_in_genome - _start_pos;</span>
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (positional_cov.count(pos_in_genome) &gt; 0) {
<a name="l00443"></a>00443      <span class="keywordflow">if</span> (positional_cov[pos_in_genome].get_phred_cov( phred_score ) &gt; 0) {
<a name="l00444"></a>00444       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00445"></a>00445      } <span class="keywordflow">else</span> {
<a name="l00446"></a>00446       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00447"></a>00447      }
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451    } <span class="keywordflow">else</span> {
<a name="l00452"></a>00452     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00453"></a>00453    }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   
<a name="l00456"></a>00456  }
<a name="l00457"></a>00457  
<a name="l00475"></a><a class="code" href="class_pileup_factory_1_1pileup__iterator.html">00475</a>  <span class="keyword">class </span><a class="code" href="class_pileup_factory_1_1pileup__iterator.html">pileup_iterator</a> {
<a name="l00476"></a>00476   
<a name="l00477"></a>00477  <span class="keyword">public</span>: 
<a name="l00483"></a><a class="code" href="class_pileup_factory_1_1pileup__iterator.html#a50cc0c2e2cc88ee53ca49e0c9af37abb">00483</a>   <span class="keywordtype">bool</span> <a class="code" href="class_pileup_factory_1_1pileup__iterator.html#a50cc0c2e2cc88ee53ca49e0c9af37abb">good</a>() { 
<a name="l00484"></a>00484    <span class="keywordflow">return</span> (itr != itr_end); 
<a name="l00485"></a>00485   }
<a name="l00486"></a>00486     
<a name="l00490"></a><a class="code" href="class_pileup_factory_1_1pileup__iterator.html#ae1b39c13e75befc882424cc2ba97d840">00490</a>   <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory_1_1pileup__iterator.html#ae1b39c13e75befc882424cc2ba97d840">next</a>() {
<a name="l00491"></a>00491    <span class="keywordflow">if</span> (itr != itr_end) {
<a name="l00492"></a>00492     ++itr;
<a name="l00493"></a>00493    }
<a name="l00494"></a>00494    
<a name="l00495"></a>00495   }
<a name="l00501"></a><a class="code" href="class_pileup_factory_1_1pileup__iterator.html#ae9b4c64e31955f28f65a5841e394add2">00501</a>   <a class="code" href="class_pileup.html">Pileup</a>&amp; <span class="keyword">get</span>() {
<a name="l00502"></a>00502    <span class="keywordflow">return</span> itr-&gt;second;
<a name="l00503"></a>00503    
<a name="l00504"></a>00504   }
<a name="l00508"></a><a class="code" href="class_pileup_factory_1_1pileup__iterator.html#a1bf8e5041e0cbf9863820b7e9e2e2dc8">00508</a>   <span class="keywordtype">int</span>  <a class="code" href="class_pileup_factory_1_1pileup__iterator.html#a1bf8e5041e0cbf9863820b7e9e2e2dc8">get_position</a>() {
<a name="l00509"></a>00509    <span class="keywordflow">if</span> (good()) {
<a name="l00510"></a>00510     <span class="keywordflow">return</span> itr-&gt;first;
<a name="l00511"></a>00511    }
<a name="l00512"></a>00512   }
<a name="l00513"></a>00513   
<a name="l00514"></a>00514   
<a name="l00515"></a>00515  <span class="keyword">private</span>:
<a name="l00516"></a>00516   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_pileup_factory.html">PileupFactory</a>;
<a name="l00517"></a>00517   <a class="code" href="class_pileup_factory_1_1pileup__iterator.html">pileup_iterator</a>(pileup_container_t::iterator container_start, pileup_container_t::iterator container_end)
<a name="l00518"></a>00518   : itr(container_start)
<a name="l00519"></a>00519   , itr_start(container_start)
<a name="l00520"></a>00520   , itr_end(container_end)
<a name="l00521"></a>00521   
<a name="l00522"></a>00522   {  };
<a name="l00523"></a>00523   
<a name="l00524"></a>00524   pileup_container_t::iterator itr;
<a name="l00525"></a>00525   pileup_container_t::iterator itr_start;
<a name="l00526"></a>00526   pileup_container_t::iterator itr_end;
<a name="l00527"></a>00527  };
<a name="l00528"></a>00528  
<a name="l00529"></a>00529  
<a name="l00535"></a><a class="code" href="class_pileup_factory.html#ab41f2591c7092b2800ba8768a3b593a6">00535</a>  <a class="code" href="class_pileup_factory_1_1pileup__iterator.html">pileup_iterator</a> <a class="code" href="class_pileup_factory.html#ab41f2591c7092b2800ba8768a3b593a6">get_pileup_iterator</a>() {
<a name="l00536"></a>00536   <span class="keywordflow">return</span> <a class="code" href="class_pileup_factory_1_1pileup__iterator.html">pileup_iterator</a>(positional_cov.begin(), positional_cov.end());
<a name="l00537"></a>00537  }
<a name="l00538"></a>00538  
<a name="l00552"></a><a class="code" href="class_pileup_factory.html#a4d203d432afda6c43c207f4b5e4062de">00552</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory.html#a4d203d432afda6c43c207f4b5e4062de">set_overlap_reads</a>(std::vector&lt;BAMRead&gt;&amp; the_overlaps) {
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   overlap_reads = the_overlaps;<span class="comment">//need to copy instead of swap.  </span>
<a name="l00555"></a>00555           <span class="comment">//don&#39;t want to assume the caller is done with these reads</span>
<a name="l00556"></a>00556 
<a name="l00557"></a>00557  }
<a name="l00558"></a>00558  
<a name="l00571"></a><a class="code" href="class_pileup_factory.html#abfb03a6dad3dbc9d7216c2d96174b42f">00571</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory.html#abfb03a6dad3dbc9d7216c2d96174b42f">handle_overlaps</a>(std::string&amp; q_score_str, coord_t start_slop) {
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="keywordflow">for</span> (std::vector&lt;BAMRead&gt;::iterator i = overlap_reads.begin(); i != overlap_reads.end(); ++i) {
<a name="l00574"></a>00574    
<a name="l00575"></a>00575    overlap_utils.push_back(<a class="code" href="class_b_a_m_utils.html">BAMUtils</a>(*i, q_score_str, 0));
<a name="l00576"></a>00576    <a class="code" href="class_pileup_factory.html#a1920bc4147b24073bf616ffb29f7ab5c">insert_util</a>(overlap_utils.back());
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578   
<a name="l00579"></a>00579  }
<a name="l00580"></a>00580  
<a name="l00581"></a>00581 
<a name="l00585"></a><a class="code" href="class_pileup_factory.html#a735687db4dba9bbd23d4ecca73b9fc1a">00585</a>  <span class="keywordtype">void</span> <a class="code" href="class_pileup_factory.html#a735687db4dba9bbd23d4ecca73b9fc1a">release_resources</a>() {
<a name="l00586"></a>00586   <span class="comment">//utils.clear();</span>
<a name="l00587"></a>00587   overlap_reads.clear();
<a name="l00588"></a>00588   overlap_utils.clear();
<a name="l00589"></a>00589   <span class="comment">//pileups.clear();</span>
<a name="l00590"></a>00590   positional_cov.clear();
<a name="l00591"></a>00591   
<a name="l00592"></a>00592   
<a name="l00593"></a>00593   
<a name="l00594"></a>00594  }
<a name="l00595"></a>00595  
<a name="l00600"></a><a class="code" href="class_pileup_factory.html#a7fa771e82cda5f6c17bc3c488bac9ad6">00600</a>  <span class="keywordtype">int</span> <a class="code" href="class_pileup_factory.html#a7fa771e82cda5f6c17bc3c488bac9ad6">get_start</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _start_pos; } 
<a name="l00606"></a><a class="code" href="class_pileup_factory.html#af7f9b6c0c1d5c5d3615bbf7fb1024731">00606</a>  <span class="keywordtype">int</span> <a class="code" href="class_pileup_factory.html#af7f9b6c0c1d5c5d3615bbf7fb1024731">get_end</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _end_pos; }
<a name="l00607"></a>00607  
<a name="l00608"></a>00608  ~<a class="code" href="class_pileup_factory.html">PileupFactory</a>() {
<a name="l00609"></a>00609   <a class="code" href="class_pileup_factory.html#a735687db4dba9bbd23d4ecca73b9fc1a">release_resources</a>();  
<a name="l00610"></a>00610   
<a name="l00611"></a>00611   
<a name="l00612"></a>00612  }
<a name="l00613"></a>00613  
<a name="l00614"></a>00614  
<a name="l00615"></a>00615  
<a name="l00616"></a>00616 <span class="keyword">private</span>:
<a name="l00617"></a>00617   
<a name="l00618"></a>00618  <span class="keywordtype">void</span> swap(<a class="code" href="class_pileup_factory.html">PileupFactory</a>&amp; first, <a class="code" href="class_pileup_factory.html">PileupFactory</a>&amp; second) {
<a name="l00619"></a>00619   <span class="comment">//if (_debug)cerr &lt;&lt; &quot;[PileupFactory] Swap&quot; &lt;&lt; endl;</span>
<a name="l00620"></a>00620   <span class="keyword">using</span> std::swap; <span class="comment">//enables ADL</span>
<a name="l00621"></a>00621   swap(first._debug, second._debug);
<a name="l00622"></a>00622   swap(first._tid, second._tid);
<a name="l00623"></a>00623   swap(first._start_pos, second._start_pos);
<a name="l00624"></a>00624   swap(first._end_pos, second._end_pos);
<a name="l00625"></a>00625   swap(first._phreds, second._phreds);
<a name="l00626"></a>00626   swap(first.positional_cov, second.positional_cov);
<a name="l00627"></a>00627   swap(first.overlap_reads, second.overlap_reads);
<a name="l00628"></a>00628   swap(first.overlap_utils, second.overlap_utils);
<a name="l00629"></a>00629   
<a name="l00630"></a>00630  }
<a name="l00631"></a>00631  
<a name="l00632"></a>00632  
<a name="l00633"></a>00633  <span class="keywordtype">bool</span>      _debug;
<a name="l00634"></a>00634  <span class="keywordtype">int</span>       _tid;
<a name="l00635"></a>00635  <span class="keywordtype">int</span>       _start_pos;
<a name="l00636"></a>00636  <span class="keywordtype">int</span>       _end_pos;
<a name="l00637"></a>00637  std::vector&lt;int&gt;       _phreds;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639  <a class="code" href="class_pileup_factory.html#ae4c0b96c035216ba005467e2d5fc3397">pileup_container_t</a>   positional_cov;
<a name="l00640"></a>00640  
<a name="l00641"></a>00641  std::vector&lt;BAMRead&gt;       overlap_reads;
<a name="l00642"></a>00642  std::vector&lt;BAMUtils&gt;       overlap_utils;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644  
<a name="l00645"></a>00645 };   
<a name="l00646"></a>00646 <span class="preprocessor">#endif //PILEUP_H</span>
<a name="l00647"></a>00647 <span class="preprocessor"></span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>Pileup.h</b>      </li>
      <li class="footer">Generated on Tue Jun 28 2011 16:13:41 for SamUtils by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>

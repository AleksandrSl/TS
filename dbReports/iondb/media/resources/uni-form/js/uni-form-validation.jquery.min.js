/**
 * Uni-Form jQuery Plugin with Validation
 *
 * Provides form actions for use with the Uni-Form markup style
 * This version adds additional support for client side validation
 *
 * Author: Ilija Studen for the purposes of Uni-Form
 *
 * Modified by Aris Karageorgos to use the parents function
 *
 * Modified by Toni Karlheinz to support input fields' text
 * coloring and removal of their initial values on focus
 *
 * Modified by Jason Brumwell for optimization, addition
 * of valid and invalid states and default data attribues
 *
 * Modified by LearningStation to add support for client
 * side validation routines. The validation routines based on an
 * open source library of unknown authorship.
 *
 * @see http://sprawsm.com/uni-form/
 * @license MIT http://www.opensource.org/licenses/mit-license.php
 */
 /*jslint devel: true, bitwise: true, browser: true, plusplus: true, maxerr: 50, indent: 4 */jQuery.fn.uniform=function(e){var a=this,t={},n=jQuery.extend(jQuery.fn.uniform.defaults,e),l=jQuery.fn.uniform.language;this.validators={get_val:function(e,a,t){var n=t;a=a.split(" ");for(var l=0;l<a.length;l+=1)if(a[l]===e&&"undefined"!=a[l+1]&&"val-"===a[l+1].substr(0,4))return n=parseInt(a[l+1].substr(4),10);return n},required:function(e,a){var t;return e.is(":radio")?(t=e.attr("name"),$("input[name="+t+"]:checked").length?!0:s("req_radio",a)):e.is(":checkbox")?(t=e.attr("name"),e.is(":checked")?!0:s("req_checkbox",a)):""===jQuery.trim(e.val())?s("required",a):!0},validateMinLength:function(e,a){var t=this.get_val("validateMinLength",e.attr("class"),0);return t>0&&e.val().length<t?s("minlength",a,t):!0},validateMin:function(e,a){var t=this.get_val("validateMin",e.attr("class"),0);return parseInt(e.val(),10)<t?s("min",a,t):!0},validateMaxLength:function(e,a){var t=this.get_val("validateMaxLength",e.attr("class"),0);return t>0&&e.val().length>t?s("maxlength",a,t):!0},validateMax:function(e,a){var t=this.get_val("validateMax",e.attr("class"),0);return parseInt(e.val(),10)>t?s("max",a,t):!0},validateSameAs:function(e,a){for(var t=e.attr("class").split(" "),n="",l="",i="",o=0;o<t.length;o+=1)if("validateSameAs"===t[o]&&"undefined"!=t[o+1]){l=t[o+1];break}if(l){var u=e.parents("form:first");if(n=jQuery('input[name="'+l+'"]',u),n.length>0&&n.val()!=e.val())return i=r(n),s("same_as",a,i)}return!0},validateEmail:function(e,a){return e.val().match(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)?!0:s("email",a)},validateUrl:function(e,a){return e.val().match(/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i)?!0:s("url",a)},validateNumber:function(e,a){return e.val().match(/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/)||""===e.val()?!0:s("number",a)},validateInteger:function(e,a){return e.val().match(/(^-?\d\d*$)/)||""===e.val()?!0:s("integer",a)},validateAlpha:function(e,a){return e.val().match(/^[a-zA-Z]+$/)?!0:s("alpha",a)},validateAlphaNum:function(e,a){return""==e.val()?!0:e.val().match(/^[a-zA-Z0-9]+$/)?s("alphanum",a):!0},validatePhrase:function(e,a){return""==e.val()||e.val().match(/^[\w\d\.\-_ ]+$/i)?!0:s("phrase",a)},validatePhone:function(e,a){var t=/^\(?(\d{3})\)?[\- ]?(\d{3})[\- ]?(\d{4})$/;return t.test(e.val())?!0:s("phone",a)},validateDate:function(e,a){return e.val().match("([0]?[1-9]|[1][0-2])/([0]?[1-9]|[1|2][0-9]|[3][0|1])/([0-9]{4}|[0-9]{2})$")?!0:s("date",a)},validateCallback:function(e,a){for(var t=e.attr("class").split(" "),n="",l=0;l<t.length;l+=1)if("validateCallback"===t[l]&&"undefined"!=t[l+1]){n=t[l+1];break}return"undefined"!=window[n]&&"function"==typeof window[n]?window[n](e,a):s("callback",a,n)},validateNuc:function(e,a){barCodeAdd=e.val().toUpperCase();for(var t=0;t<barCodeAdd.length;t++){var n=barCodeAdd.charAt(t);if("A"!==n&&"T"!==n&&"C"!==n&&"G"!==n)return s("nuc",a)}return!0},validateAlphaNumNoSpace:function(e,a){return""==e.val()?!0:e.val().match(/^[a-zA-Z0-9-_\.]+$/)?!0:s("annospace",a)},validateAlphaNumUnderscoreNoSpace:function(e,a){return""==e.val()?!0:e.val().match(/^[a-zA-Z0-9_]+$/)?!0:s("anundernospace",a)},validateAlphaNumUnderscorePlusDotDashNoSpace:function(e,a){return""==e.val()?!0:e.val().match(/^[a-zA-Z0-9\_\+\.\-]+$/)?!0:s("anunderplusdotdashnospace",a)},validateIntegerNoZero:function(e,a){return""===e.val()?!0:e.val().match(/(^-?\d\d*$)/)&&parseInt(e.val())>0?!0:s("uint",a)},validateUniq:function(e,a){return isUniq=$.inArray(e.val(),uniq),-1===isUniq?!0:s("uniq",a)},validateHTTPUrl:function(e,a){return e.val().match(/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i)?!0:s("url_http",a)},validateFilenameRegex:function(e,a){return 0==e.val().length?!0:e.val().match(/^([A-Za-z0-9_\-\/\?\!\*\.\"\']+)/)?!0:s("filenameregex",a)}};var r=function(e){var a=e.closest("label").text();return""===a&&(a=e.closest("div."+n.holder_class).find("label").text()),a.replace("*","").replace(":","")},s=function(e){for(var a,t=l[e],n=t.split("%"),r=n[0],s=/^([ds])(.*)$/,i=1;i<n.length;i+=1)a=s.exec(n[i]),a&&null!==arguments[i]&&("d"===a[1]?r+=parseInt(arguments[i],10):"s"===a[1]&&(r+=arguments[i]),r+=a[2]);return r};return this.each(function(){var e=jQuery(this),l=function(e,a,l){var r=e.closest("div."+n.holder_class).andSelf().toggleClass(n.invalid_class,!a).toggleClass(n.error_class,!a).toggleClass(n.valid_class,a).find(n.msg_selector);a?name in t&&delete t[name]:t[name]=l,a||r.data("info-text")?a&&(l=r.data("info-text")):r.data("info-text",r.html()),l&&r.html(l)};if(e.find(n.field_selector).each(function(){var e=$(this),a=e.val();e.data("default-color",e.css("color")),a!==e.data("default-value")&&a||(e.not("select").css("color",n.default_value_color),e.val(e.attr("data-default-value")))}),n.ask_on_leave||e.hasClass("askOnLeave")){var i=e.serialize();$(window).bind("beforeunload",function(){return i!=e.serialize()&&(n.ask_on_leave||e.hasClass("askOnLeave"))?$.isFunction(n.on_leave_callback)?n.on_leave_callback(e):confirm(s("on_leave")):void 0})}e.submit(function(){var a,t=!0;return e.removeClass("failedSubmit"),n.ask_on_leave=!1,e.removeClass("askOnLeave"),e.find(n.field_selector).each(function(){$(this).val()===$(this).data("default-value")&&$(this).val("")}),n.prevent_submit||e.hasClass("preventSubmit")?(e.find(n.field_selector).each(function(){$(this).blur()}),$.isFunction(n.submit_callback)&&(t=n.submit_callback(e)),(e.find("."+n.invalid_class).add("."+n.error_class).length||!t)&&(a=$.isFunction(n.prevent_submit_callback)?n.prevent_submit_callback(e,s("submit_msg"),[s("submit_help")]):jQuery.fn.uniform.showFormError(e,s("submit_msg"),[s("submit_help")]))):a=!0,e.parents("#qunit-fixture").length&&(a=!1),a===!1&&e.addClass("failedSubmit"),a}),e.delegate(n.field_selector,"focus",function(){e.find("."+n.focused_class).removeClass(n.focused_class);var a=$(this);a.parents().filter("."+n.holder_class+":first").addClass(n.focused_class),a.val()===a.data("default-value")&&a.val(""),a.not("select").css("color",a.data("default-color"))}),e.delegate(n.field_selector,"blur",function(){var t,l=$(this),s=!1,i=r($(this));if(e.find("."+n.focused_class).removeClass(n.focused_class),l.val()===l.data("default-value")&&!l.hasClass("required"))return l.not("select").css("color",n.default_value_color),void l.val(l.data("default-value"));for(t in a.validators)if(l.hasClass(t)){s=!0;var o=a.validators[t](l,i);if("string"==typeof o)return void l.trigger("error",o)}s&&l.trigger("success"),l.css("color",l.data("default-color"))}),e.delegate(n.field_selector,"error",function(e,a){l($(this),!1,a)}),e.delegate(n.field_selector,"success",function(){l($(this),!0)}),$("input[autofocus]:first").focus()})},jQuery.fn.uniform.showFormError=function(e,a,t){var n,l;if($("#errorMsg").length&&$("#errorMsg").remove(),l=$("<div />").attr("id","errorMsg").html("<h3>"+a+"</h3>"),t.length){l.append($("<ol />"));for(n in t)$("ol",l).append($("<li />").text(t[n]))}return e.prepend(l),$("html, body").animate({scrollTop:e.offset().top},500),$("#errorMsg").slideDown(),!1},jQuery.fn.uniform.showFormSuccess=function(e,a){var t;return $("#okMsg").length&&$("#okMsg").remove(),t=$("<div />").attr("id","okMsg").html("<h3>"+a+"</h3>"),e.prepend(t),$("html, body").animate({scrollTop:e.offset().top},500),$("#okMsg").slideDown(),!1},jQuery.fn.uniform.isValid=function(e,a){return e.find(a.field_selector).each(function(){$(this).blur()}),0===e.find("."+a.invalid_class).add("."+a.error_class).length},jQuery.fn.uniform.language={required:"",req_radio:"Please make a selection",req_checkbox:"You must select this checkbox to continue",minlength:"%s should be at least %d characters long",min:"%s should be greater than or equal to %d",maxlength:"%s should not be longer than %d characters",max:"%s should be less than or equal to %d",same_as:"%s is expected to be same as %s",email:"%s is not a valid email address",url:"%s is not a valid URL",number:"%s needs to be a number",integer:"%s needs to be a whole number",alpha:"%s should contain only letters (without special characters or numbers)",alphanum:"%s should contain only numbers and letters (without special characters)",phrase:"%s should contain only alphabetic characters, numbers, spaces, and the following: . - _ ",phone:"%s should be a phone number",date:"%s should be a date (mm/dd/yyyy)",callback:"Failed to validate %s field. Validator function (%s) is not defined!",on_leave:"Are you sure you want to leave this page without saving this form?",submit_msg:"Sorry, this form needs corrections.",submit_help:"Please see the items marked below.",submit_success:"Thank you, this form has been sent.",nuc:"%s needs to be one of the following:  A, T, C, G",annospace:"%s should contain only numbers, letters, and the following: . - _ ",anundernospace:"%s should contain only numbers, letters or underscore.",anunderplusdotdashnospace:"%s should contain only numbers, letters, plus, dot, dash or underscore(+.-_).",uint:"%s needs to be a whole number greater than 0",uniq:"%s is already in use, please enter another barcode id",url_http:"%s is not a valid HTTP-based URL. Must begin with http:// or https://.",filenameregex:"%s is not a valid pattern.  Allowable characters include (comma-separated): A-Z,a-z,0-9,_,-,/,?.,!,*,."},jQuery.fn.uniform.defaults={submit_callback:!1,prevent_submit:!1,prevent_submit_callback:!1,ask_on_leave:!1,on_leave_callback:!1,valid_class:"valid",invalid_class:"invalid",error_class:"error",focused_class:"focused",holder_class:"ctrlHolder",field_selector:"input, textarea, select",default_value_color:"#AFAFAF",msg_selector:"p.formHint"};

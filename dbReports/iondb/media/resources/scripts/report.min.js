function htmlEscape(e){return String(e).replace(/&/g,"&").replace(/"/g,""").replace(/'/g,"&#39;").replace(/</g,"<").replace(/>/g,">").replace(/\n/g,"<br/>")}function resizeiFrames(){$(".pluginBlock:visible").each(function(){var e=$(this).contents().height(),t=$(".pluginGroupList").css("width");if($(this).height()!=e)$(this).height(e);if($(this).width()!=t)$(this).width(t)});$(".pluginMajorBlock:visible").each(function(){var e=$(this).contents().height(),t=parseInt($(".section").css("width"),10)-20;if($(this).height()!=e)$(this).height(e);if($(this).width()!=t)$(this).width(t)})}function pluginStatusLoad(){$("#pluginRefresh").activity({segments:10,width:3,space:2,length:3,color:"#252525",speed:1.5,padding:"3",align:"left"});$("#pluginStatusTable").fadeOut();$("#pluginStatusTable").html("");$.ajax({type:"GET",url:djangoURL,contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(e){var t=kendo.template($("#pluginStatusTemplate").html());for(var n=0;n<e.length;n++){var r=t(e[n]);$("#pluginStatusTable").append(r).find(".plugin-collapse:last").click(function(){$(this).text($(this).text()=="-"?"+":"-");$(this).closest(".pluginGroup").find(".pluginGroupList").slideToggle(250);return false})}},error:function(e){$("#pluginStatusTable").text("Failed to get Plugin Status: "+e)}});$("#pluginStatusTable").fadeIn();$("#pluginRefresh").activity(false)}function progress_load(){$.ajax({type:"GET",url:reportAPI,contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(e){$("#progress_message").html(e.status);if(e.status.indexOf("Completed")===0){clearInterval($(document).data("report_progress"));if(e.status==="Completed"){$("#progress_message").html("The report has been completed. The page will reload in 5 seconds");setTimeout(function(){location.reload()},5e3)}}},error:function(e){$("#progress_message").html("Error checking status")}})}String.prototype.endsWith=function(e){return this.match(e+"$")==e};$(document).ready(function(){djangoPK=$("#report").data("pk");webLink=$("#report").data("web");reportAPI="/rundb/api/v1/results/"+djangoPK+"/";djangoURL="/rundb/api/v1/results/"+djangoPK+"/pluginresults/";$("#resultList").blur();$("#barcodes tr").click(function(){var e=$(this).find("td:first").text().trim()});$("#CA_barcodes tr").click(function(){var e=$(this).find("td:first").text().trim()});$.colorbox.close=function(){location.reload()};$("#close_progress").click(function(){$("#backdrop_progress, #progress").remove();clearInterval($(document).data("report_progress"))});protonData=$("#report").data("php")+" #isMap";$("#proton").load(protonData);var e=$("#q30_quality").data("percent");$("#q30_quality").strength(e,"undefined",e,"Sequence >= Q30");$("#plugin-modal").modal({backdrop:true,show:false});$("#resultList").change(function(){window.location="/report/"+$(this).val()});$("#review_plan").click(function(e){e.preventDefault();$("#error-messages").hide().empty();pk=$(this).data("pk");url="/plan/reviewplan/"+pk+"/";$("body #modal_review_plan").remove();$.get(url,function(e){$("body").append(e);$("#modal_review_plan").modal("show");return false}).done(function(e){}).fail(function(e){$("#error-messages").empty().show();$("#error-messages").append('<p class="error">ERROR: '+e.responseText+"</p>")}).always(function(e){})});$("#copy_plan").click(function(e){$("body").css("cursor","wait");e.preventDefault();$("#error-messages").hide().empty();var t='<div class="myBusyDiv"><div class="k-loading-mask" style="width:100%;height:100%"><span class="k-loading-text">Loading...</span><div class="k-loading-image"><div class="k-loading-color"></div></div></div></div>';$("body").prepend(t);pk=$(this).data("pk");url="/plan/planned/"+pk+"/copy/";$("body #modal_plan_wizard").remove();$("body #modal_plan_run").remove();$.get(url,function(e){$("body").append(e);setTab("#ws-1");$("#modal_plan_wizard").modal("show");return false}).done(function(e){console.log("success:",url)}).fail(function(e){$("body").css("cursor","default");$(".myBusyDiv").empty();$("body").remove(".myBusyDiv");$("#error-messages").empty().show();$("#error-messages").append('<p class="error">ERROR: '+e.responseText+"</p>");console.log("error:",e)}).always(function(e){$("body").css("cursor","default");$(".myBusyDiv").empty();$("body").remove(".myBusyDiv");delete t})});pluginStatusLoad();$.ajax({type:"GET",url:djangoURL+"?major=true",contentType:"application/json; charset=utf-8",dataType:"json",async:false,success:function(e){if($.browser.msie){iframescroll="yes"}else{iframescroll="no"}for(var t=0;t<e.length;t++){if(e[t].Files.length>0){$("#major_blocks").append("<h2>"+e[t].Name+" ("+e[t].Version+') </h2> <div class="section"><iframe scrolling="'+iframescroll+'" id="'+e[t].Name+'" class="pluginMajorBlock" src="'+webLink+"/plugin_out/"+e[t].Name+"_out/"+e[t].Files[0]+'" frameborder="0" height="0px" ></iframe></div>')}}}});$(".pluginRemove").live("click",function(e){e.preventDefault();var t=$(this).attr("href");var n=$(this).closest("div.pluginGroup");$.ajax({type:"DELETE",url:t,async:true,beforeSend:function(){n.animate({backgroundColor:"#fb6c6c"},300)}}).done(function(){n.fadeOut(300,function(){n.remove()})});return false});$(".pluginLog").live("click",function(e){e.preventDefault();var t=$(this).attr("href");var n=$($(this)).data("title");var r=$($(this).parent());r.activity({segments:10,width:3,space:2,length:2.5,color:"#252525",speed:1.5,padding:"3"});$.get(t,function(e){r.activity(false);var t=$("#modal_plugin_log");t.find(".modal-body").html('<pre class="log">'+htmlEscape(e)+"</pre>");t.find(".modal-header h3").text(n);t.modal("show")});return false});$("#pluginRefresh").click(function(){pluginStatusLoad()});$("#pluginExpandAll").click(function(){$("#pluginStatusTable .plugin-collapse").text("-");$("#pluginStatusTable .pluginGroupList").show()});$("#pluginCollapseAll").click(function(){$("#pluginStatusTable .plugin-collapse").text("+");$("#pluginStatusTable .pluginGroupList").hide()});$("#pluginDialogButton").click(function(){$("#plugin-modal").modal("show");$("#modal-body").html("<div id='pluginLoad'></div><div id='pluginList'></div>");$("#pluginLoad").html("<span>Loading Plugin List <img src='/site_media/jquery/colorbox/images/loading.gif'></img></span>");$.ajax({url:"/rundb/api/v1/plugin/?selected=true&limit=0&format=json&order_by=name",dataType:"json",type:"GET",async:false,success:function(e){var t=[];if(e.objects.length===0){$("#pluginLoad").html("");$("#pluginList").html("<p> There are no plugins what are enabled </p>");return false}$("#pluginList").html('<ul id="pluginUL" class="expandable"></ul>');plugins=e.objects.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1});plugin_ids="";$.each(plugins,function(e,t){plugin_ids+=t.id;if(e+1!=plugins.length){plugin_ids+=";"}});$.ajax({url:"/rundb/api/v1/plugin/set/"+plugin_ids+"/type/?format=json",success:function(t){for(var n=0;n<plugins.length;n++){val=plugins[n];e=t[val.id];if(e.input!==undefined){$("#pluginUL").append('<li data-id="'+val.id+'" class="plugin_input_class" id="'+val.name+'_plugin"><a href="'+e.input+"?report="+djangoPK+'" class="plugin_link colorinput">'+val.name+"</a>"+"<span>"+" &#8212; v"+val.version+"</span></li>")}else{$("#pluginUL").append('<li data-id="'+val.id+'" class="plugin_class" id="'+val.name+'_plugin"><a href="#pluginDialog">'+val.name+"</a>"+"<span>"+" &#8212; v"+val.version+"</span></li>")}}},async:false,type:"GET",dataType:"json"});$("#pluginLoad").html("");$("#modal-header").html("Select a plugin");$("#pluginList").show()}});$(".plugin_link").colorbox({width:"90%",height:"90%",iframe:true});$(".plugin_input_class").die("click");$(".plugin_input_class").live("click",function(){$("#plugin-modal").modal("hide")});$(".plugin_class").die("click");$(".plugin_class").live("click",function(){var e=$(this).data("id");var t=$(this).attr("id");t=t.substring(0,t.length-7);pluginAPIJSON={plugin:[t]};pluginAPIJSON=JSON.stringify(pluginAPIJSON);$.ajax({type:"POST",url:djangoURL,async:true,contentType:"application/json; charset=utf-8",data:pluginAPIJSON,dataType:"json",beforeSend:function(){$("#pluginList").html("");$("#pluginLoad").html("<span>Launching Plugin "+t+" <img src='/site_media/jquery/colorbox/images/loading.gif'></img></span>")},success:function(){$("#plugin-modal").modal("hide");pluginStatusLoad()}})})});if($.QueryString.no_header){$(".tab-pane").each(function(){$(this).removeClass("tab-pane");$(this).addClass("tabBox");$(this).prepend("<h2>"+$(this).data("title")+"</h2><hr/>")});$(".nav,.sub-nav,.page-nav,.btn, #resultSet,.footer,#resultSet,#OutputFiles").hide();$(".main-push").remove();$(".main").css({background:"-webkit-gradient(linear, 0% 0%, 100% 100%, from(#ffffff), to(#ffffff))"});$(".header").hide();$("#nameRow").removeClass("span6").addClass("span12");$("#beadfind, #basecaller, #readlength").removeClass("span3").addClass("span4");$("#alignMap, #rawAligned").removeClass("span3").addClass("span6");$(".tabBox").css({border:"3px black solid",margin:"20px"});$(".pluginGroup").css({border:"1px black solid",margin:"10px"});$(".unaligned .well").css("min-height","390px");$(".aligned .well").css({"min-height":"370px",height:"370px"});$(".content").css({"box-shadow":"0px 0px","border-radius":"0px",border:"0px"})}else{resizeIntervalTimer=setInterval(function(){resizeiFrames()},1e3);if(typeof CA_barcodes_json!=="undefined"){$("#CA_barcodes").kendoGrid({dataSource:{data:CA_barcodes_json,schema:{model:{fields:{ID:{type:"string"},Filtered_Mapped_Bases_in_Q7_Alignments:{type:"integer"},Total_number_of_Reads:{type:"integer"},Filtered_Q7_Mean_Alignment_Length:{type:"integer"}}}},pageSize:10},height:"auto",groupable:false,scrollable:false,selectable:false,sortable:{mode:"multiple",allowUnsort:true},pageable:{pageSizes:[5,10,20,50,100,1e3]},columns:[{field:"ID",title:"Barcode Name"},{field:"Filtered_Mapped_Bases_in_Q7_Alignments",title:"Aligned Output"},{field:"Total_number_of_Reads",title:"Reads"},{field:"Filtered_Q7_Mean_Alignment_Length",title:"Mean Aligned Read Length"},{title:"BAM",sortable:false}],rowTemplate:kendo.template($("#CA_barcodesRowTemplate").html())})}if(typeof barcodes_json!=="undefined"){$("#barcodes").kendoGrid({dataSource:{data:barcodes_json,schema:{model:{fields:{barcode_name:{type:"string"},sample:{type:"string"},total_bases:{type:"integer"},Q20_bases:{type:"integer"},read_count:{type:"integer"},mean_read_length:{type:"string"},filtered:{type:"boolean"},file_prefix:{type:"string"},bam_link:{type:"string"},bai_link:{type:"string"}}}},pageSize:10},height:"auto",groupable:false,scrollable:false,selectable:false,sortable:{mode:"multiple",allowUnsort:true},pageable:{pageSizes:[5,10,20,50,100,1e3]},columns:[{field:"barcode_name",title:"Barcode Name"},{field:"sample",title:"Sample"},{field:"total_bases",title:"Bases"},{field:"Q20_bases",title:">=Q20 Bases"},{field:"read_count",title:"Reads"},{field:"mean_read_length",title:"Mean Read Length"},{title:"Read Length Histogram",sortable:false},{title:"BAM",sortable:false}],rowTemplate:kendo.template($("#barcodesRowTemplate").html())})}$("#file_table").kendoGrid({dataSource:{pageSize:10},height:"auto",groupable:false,scrollable:false,selectable:false,sortable:false,pageable:false});$("#test_fragments").kendoGrid({dataSource:{pageSize:10},height:"auto",groupable:false,scrollable:false,selectable:false,sortable:false,pageable:true})}})
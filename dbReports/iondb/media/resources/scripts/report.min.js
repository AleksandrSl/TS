//this file has the JavaScript for the default report
function htmlEscape(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}function resizeiFrames(){$(".pluginBlock:visible").each(function(){var e=$(this).contents().height(),t=$(".pluginGroupList").css("width");$(this).height()!=e&&$(this).height(e),$(this).width()!=t&&$(this).width(t)}),$(".pluginMajorBlock:visible").each(function(){var e=$(this).contents().height(),t=parseInt($(".section").css("width"),10)-20;e=e>800?800:e,$(this).height()!=e&&$(this).height(e),$(this).width()!=t&&$(this).width(t)}),$.browser.msie&&$(".pluginBlock, .pluginMajorBlock").css("height",400)}function pluginStatusLoad(){$("#pluginRefresh").activity({segments:10,width:3,space:2,length:3,color:"#252525",speed:1.5,padding:"3",align:"left"}),$("#pluginStatusTable").fadeOut(),$("#pluginStatusTable").html(""),$.ajax({type:"GET",url:djangoURL,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){$.browser.msie?iframescroll="yes":iframescroll="no";for(var t=0;t<e.length;t++){var n="";n+="<div class='pluginGroup'><div class='pluginGroupHead'><div class='pluginGroupHeadInner'>",n+='<button class="btn plugin-collapse">-</button> ',n+=e[t].Name,n+=" &#8212; v",n+=e[t].Version,n+='<a class="pluginLog ui-icon ui-icon-script" data-title="Log for '+e[t].Name+'" title="Log File for '+e[t].Name+'" href="'+webLink+"/plugin_out/"+e[t].Name+'_out/drmaa_stdout.txt">log</a>',n+="<strong class='pluginState'> "+e[t].State+"</strong>",n+="</div></div>",n+='<div class="pluginGroupList" id="'+e[t].Name+'">';if(e[t].Files)for(var r=0;r<e[t].Files.length;r++)(e[t].Files[r].endsWith("_block.html")||e[t].Files[r].endsWith("_block.php"))&&!e[t].Major?n+='<div class="pluginBlock"><iframe id="'+e[t].Name+'" class="pluginBlock" src="'+webLink+"/plugin_out/"+e[t].Name+"_out/"+e[t].Files[r]+'" width="95%" frameborder="0" height="0px" scolling="'+iframescroll+'"></iframe></div>':(n+='<div class="pluginFile">&bull;<a href="'+webLink+"/plugin_out/"+e[t].Name+"_out/"+e[t].Files[r]+'"> ',n+=e[t].Files[r],n+="</a></div>");n+="</div>",$("#pluginStatusTable").append(n).find(".plugin-collapse:last").click(function(){return $(this).text($(this).text()=="-"?"+":"-"),$(this).closest(".pluginGroup").find(".pluginGroupList").slideToggle(250),!1})}},error:function(e){$("#pluginStatusTable").text("Failed to get Plugin Status: "+e)}}),$("#pluginStatusTable").fadeIn(),$("#pluginRefresh").activity(!1)}function progress_load(){$.ajax({type:"GET",url:reportAPI,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){$("#progress_message").html(e.status),e.status==="Completed"&&($("#progress_message").html("The report has been completed. The page will reload in 5 seconds"),setTimeout(function(){location.reload()},5e3))},error:function(e){$("#progress_message").html("Error checking status")}})}String.prototype.endsWith=function(e){return this.match(e+"$")==e},$(document).ready(function(){djangoPK=$("#report").data("pk"),webLink=$("#report").data("web"),reportAPI="/rundb/api/v1/results/"+djangoPK+"/",djangoURL="/rundb/api/v1/results/"+djangoPK+"/pluginresults/",$("#barcodes tr").click(function(){var e=$(this).find("td:first").text().trim()}),$.colorbox.close=function(){location.reload()},$("#close_progress").click(function(){$("#backdrop_progress, #progress").remove(),clearInterval($(document).data("report_progress"))}),protonData=$("#report").data("php")+" #isMap",$("#proton").load(protonData),phpInfo=$("#report").data("php")+" #ReportInfo div div table:eq(1)",$("#AnalysisDetails").load(phpInfo,function(e,t,n){var r=$("#AnalysisDetails tbody tr:has(th:contains('Run Date')) td:first");r.text(kendo.toString(new Date(Date.parse(r.text().replace(" ","T"))),"yyyy/MM/dd hh:mm tt"))}),phpSoftware=$("#report").data("php")+" #ReportInfo div div table:eq(2)",$("#SoftwareVersion").load(phpSoftware,function(){});var e=$("#q30_quality").data("percent");$("#q30_quality").strength(e,"undefined",e,"Sequence >= Q30"),$("#plugin-modal").modal({backdrop:!0,show:!1}),$("#resultList").change(function(){window.location="/report/"+$(this).val()}),$("#review_plan").click(function(e){e.preventDefault(),pk=$(this).data("pk"),url="/plan/reviewplan/"+pk+"/",$("body #modal_review_plan").remove(),$.get(url,function(e){return $("body").append(e),$("#modal_review_plan").modal("show"),!1}).done(function(e){}).fail(function(e){$("#error-messages").empty(),$("#error-messages").append('<p class="error">ERROR: '+e.responseText+"</p>")}).always(function(e){})}),pluginStatusLoad(),$.ajax({type:"GET",url:djangoURL+"?major=true",contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){$.browser.msie?iframescroll="yes":iframescroll="no";for(var t=0;t<e.length;t++)e[t].Files.length>0&&$("#major_blocks").append("<h2>"+e[t].Name+" ("+e[t].Version+') </h2> <div class="section"><iframe scrolling="'+iframescroll+'" id="'+e[t].Name+'" class="pluginMajorBlock" src="'+webLink+"/plugin_out/"+e[t].Name+"_out/"+e[t].Files[0]+'" frameborder="0" height="0px" ></iframe></div>')}}),$(".pluginLog").live("click",function(){var e=$(this).attr("href");dialog=$("#logBox"),dialog.html("");var t=$($(this)).data("title"),n=$($(this).parent());return n.activity({segments:10,width:3,space:2,length:2.5,color:"#252525",speed:1.5,padding:"3"}),$.get(e,function(e){dialog.html(htmlEscape(e)),n.activity(!1),dialog.dialog({width:900,height:600,title:t,buttons:[{text:"Close",click:function(){$(this).dialog("close")}}]})}),!1}),$("#pluginRefresh").click(function(){pluginStatusLoad()}),$("#pluginDialogButton").click(function(){$("#plugin-modal").modal("show"),$("#modal-body").html("<div id='pluginLoad'></div><div id='pluginList'></div>"),$("#pluginLoad").html("<span>Loading Plugin List <img src='/site_media/jquery/colorbox/images/loading.gif'></img></span>"),$.ajax({url:"/rundb/api/v1/plugin/?selected=true&limit=0&format=json&order_by=name",dataType:"json",type:"GET",async:!1,success:function(e){var t=[];if(e.objects.length==0)return $("#pluginLoad").html(""),$("#pluginList").html("<p> There are no plugins what are enabled </p>"),!1;$("#pluginList").html('<ul id="pluginUL" class="expandable"></ul>'),plugins=e.objects.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1}),plugin_ids="",$.each(plugins,function(e,t){plugin_ids+=t.id,e+1!=plugins.length&&(plugin_ids+=";")}),$.ajax({url:"/rundb/api/v1/plugin/set/"+plugin_ids+"/type/?format=json",success:function(t){for(var n=0;n<plugins.length;n++)val=plugins[n],e=t[val.id],e.input!=undefined?$("#pluginUL").append('<li data-id="'+val.id+'" class="plugin_input_class" id="'+val.name+'_plugin"><a href="'+e.input+"?report="+djangoPK+'" class="plugin_link colorinput">'+val.name+"</a>"+"<span>"+" &#8212; v"+val.version+"</span></li>"):$("#pluginUL").append('<li data-id="'+val.id+'" class="plugin_class" id="'+val.name+'_plugin"><a href="#pluginDialog">'+val.name+"</a>"+"<span>"+" &#8212; v"+val.version+"</span></li>")},async:!1,type:"GET",dataType:"json"}),$("#pluginLoad").html(""),$("#modal-header").html("Select a plugin"),$("#pluginList").show()}}),$(".plugin_link").colorbox({width:"90%",height:"90%",iframe:!0}),$(".plugin_input_class").die("click"),$(".plugin_input_class").live("click",function(){$("#plugin-modal").modal("hide")}),$(".plugin_class").die("click"),$(".plugin_class").live("click",function(){var e=$(this).data("id"),t=$(this).attr("id");t=t.substring(0,t.length-7),pluginAPIJSON={plugin:[t]},pluginAPIJSON=JSON.stringify(pluginAPIJSON),$.ajax({type:"POST",url:djangoURL,async:!0,contentType:"application/json; charset=utf-8",data:pluginAPIJSON,dataType:"json",beforeSend:function(){$("#pluginList").html(""),$("#pluginLoad").html("<span>Launching Plugin "+t+" <img src='/site_media/jquery/colorbox/images/loading.gif'></img></span>")},success:function(){$("#plugin-modal").modal("hide"),pluginStatusLoad()}})})}),$.QueryString.no_header?($(".tab-pane").each(function(){$(this).removeClass("tab-pane"),$(this).addClass("tabBox"),$(this).prepend("<h2>"+$(this).data("title")+"</h2><hr/>")}),$(".nav,.sub-nav,.page-nav,.btn, #resultSet,.footer,#resultSet,#OutputFiles").hide(),$(".main-push").remove(),$(".main").css({background:"-webkit-gradient(linear, 0% 0%, 100% 100%, from(#ffffff), to(#ffffff))"}),$(".header").hide(),$("#nameRow").removeClass("span6").addClass("span12"),$("#beadfind, #basecaller, #readlength").removeClass("span3").addClass("span4"),$("#alignMap, #rawAligned").removeClass("span3").addClass("span6"),$(".tabBox").css({border:"3px black solid",margin:"20px"}),$(".pluginGroup").css({border:"1px black solid",margin:"10px"}),$(".unaligned .well").css("min-height","390px"),$(".aligned .well").css({"min-height":"370px",height:"370px"}),$(".content").css({"box-shadow":"0px 0px","border-radius":"0px",border:"0px"})):(resizeIntervalTimer=setInterval(function(){resizeiFrames()},1e3),$("#barcodes").kendoGrid({dataSource:{pageSize:10},height:"auto",groupable:!1,scrollable:!1,selectable:!1,sortable:!1,pageable:!0}),$("#file_table").kendoGrid({dataSource:{pageSize:10},height:"auto",groupable:!1,scrollable:!1,selectable:!1,sortable:!1,pageable:!1}),$("#test_fragments").kendoGrid({dataSource:{pageSize:10},height:"auto",groupable:!1,scrollable:!1,selectable:!1,sortable:!1,pageable:!0}))});
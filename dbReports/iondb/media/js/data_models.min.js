function addCommas(e){e+="";var t=e.split("."),n=t[0],r=t.length>1?"."+t[1]:"",i=/(\d+)(\d{3})/;while(i.test(n))n=n.replace(i,"$1,$2");return n+r}function precisionUnits(e){e=parseFloat(e);var t="",n=Math.floor(Math.log(e)/Math.log(1e3));return n>=0&&(e=Math.round(100*e/Math.pow(1e3,n))/100),Math.round(e)>=1e3&&(e/=1e3,n+=1),n>=1&&(t="kMGTPEY"[n-1]),e.toPrecision(3)+" "+t}$(function(){PaginatedCollection=Backbone.Collection.extend({initialize:function(e,t){_.bindAll(this,"parse","url","pageInfo","nextPage","previousPage","filtrate","order_by"),typeof t!="undefined"||(t={}),typeof t.limit!="undefined"&&(this.limit=t.limit),typeof this.limit!="undefined"||(this.limit=20),typeof this.offset!="undefined"||(this.offset=0),typeof this.filter_options!="undefined"||(this.filter_options={}),typeof this.sort_field!="undefined"||(this.sort_field="")},fetch:function(e){console.log("Fetching"),typeof e!="undefined"||(e={});var t=this,n=e.success;return e.success=function(e){n&&n(t,e)},Backbone.Collection.prototype.fetch.call(this,e)},parse:function(e){return console.log("Parsing response"),this.offset=e.meta.offset,this.limit=e.meta.limit,this.total=e.meta.total_count,e.objects},update:function(e,t){var n,r,i,s,o,u,a={},f={},l=[];t||(t={}),e=_.isArray(e)?e.slice():[e];var c=0;for(n=0,i=e.length;n<i;n++){if(!(s=e[n]=this._prepareModel(e[n],t)))throw new Error("Can't add an invalid model to a collection");o=s.cid,u=s.id,duplicate=a[o]||this._byCid[o]||u!=null&&(f[u]||this._byId[u]),duplicate?l.push(duplicate):(l.push(null),c++),a[o]=f[u]=s}for(n=0,i=e.length;n<i;n++)l[n]||((s=e[n]).on("all",this._onModelEvent,this),this._byCid[s.cid]=s,s.id!=null&&(this._byId[s.id]=s));for(n=this.models.length-1;n>=0;n--)s=this.models[n],u=s.id,f[u]||(delete this._byId[s.id],delete this._byCid[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),this._removeReference(s));this.length+=c,r=t.at!=null?t.at:this.models.length;for(n=0;n<i;n++)s=e[n],l[n]!=null?l[n].set(s,{silent:!0}):this.models.splice(r++,0,s);this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=this.models.length;n<i;n++)s=this.models[n],t.index=n,l[n]?s.change():(console.log("Add"),console.log(s),s.trigger("add",s,this,t));return this},url:function(){urlparams={offset:this.offset,limit:this.limit},urlparams=$.extend(urlparams,this.filter_options),this.sort_field&&(urlparams=$.extend(urlparams,{order_by:this.sort_field}));var e=this.baseUrl+"/?"+$.param(urlparams);return console.log(e),e},pageInfo:function(){var e=Math.min(this.total,this.offset+this.limit);this.total==this.pages*this.limit&&(e=this.total);var t={total:this.total,offset:this.offset,limit:this.limit,pages:Math.ceil(this.total/this.limit),lower_range:this.offset+1,upper_range:e,prev:!1,next:!1};return this.offset>0&&(t.prev=this.offset-this.limit||1),this.offset+this.limit<t.total&&(t.next=this.offset+this.limit),t},nextPage:function(){return this.pageInfo().next?(this.offset=this.offset+this.limit,this.fetch()):!1},previousPage:function(){return this.pageInfo().prev?(this.offset=this.offset-this.limit||0,this.fetch()):!1},lastPage:function(){return this.pageInfo().next?(this.offset=this.total-this.limit,this.fetch()):!1},firstPage:function(){return this.pageInfo().prev?(this.offset=0,this.fetch()):!1},filtrate:function(e){return console.log("Filtering"),this.filter_options=e||{},this.offset=0,this.fetch()},order_by:function(e){return this.sort_field=e,this.offset=0,this.fetch()}}),PaginatedView=Backbone.View.extend({initialize:function(){_.bindAll(this,"previous","next","render"),this.collection.bind("reset",this.render),this.collection.bind("add",this.render),this.collection.bind("remove",this.render)},events:{"click .prev":"previous","click .next":"next","click .first":"first","click .last":"last"},template:Hogan.compile($("#pagination_template").html()),render:function(){this.$el.html(this.template.render(this.collection.pageInfo()))},previous:function(){return this.collection.previousPage(),!1},next:function(){return this.collection.nextPage(),!1},first:function(){return this.collection.firstPage(),!1},last:function(){return this.collection.lastPage(),!1}}),TastyModel=Backbone.Model.extend({url:function(){return this.baseUrl+"/"+this.id+"/"},patch:function(e){this.set(e),$.ajax({url:this.url(),type:"PATCH",data:JSON.stringify(e),contentType:"application/json"})}}),Report=TastyModel.extend({parse:function(e){return _.extend(e,{timeStamp:new Date(Date._parse(e.timeStamp))})},isCompleted:function(){return this.get("status")=="Complete"},baseUrl:"/rundb/api/v1/results"}),ReportList=PaginatedCollection.extend({model:Report,baseUrl:"/rundb/api/v1/compositeresult"}),Run=TastyModel.extend({initialize:function(){this.reports=new ReportList(this.get("results"),{parse:!0});var e=this;this.bind("change",function(){e.reports.reset(e.get("results"))})},parse:function(e){return _.extend(e,{date:new Date(Date._parse(e.date)),resultDate:new Date(Date._parse(e.resultDate))})},baseUrl:"/rundb/api/v1/experiment"}),RunList=PaginatedCollection.extend({model:Run,baseUrl:"/rundb/api/v1/compositeexperiment"}),RunRouter=Backbone.Router.extend({routes:{full:"full_view",table:"table_view"},full_view:function(){console.log("Full view!")},table_view:function(){console.log("Table view!")}})});
// jquery.daterangepicker plugin 1.0
// May be freely distributed under the MIT and GPL licenses
// Copyright (c) 2011 Raymond Julin
// Copyright (c) 2010 Filament Group, Inc
//
// Forked off daterangepicker.jQuery.js
// by Scott Jehl, scott@filamentgroup.com (http://www.filamentgroup.com/lab/update_date_range_picker_with_jquery_ui/)
// Dependencies: jquery, jquery UI datepicker, date.js, jQuery UI CSS Framework
(function(e){var t=function(t){function v(e){return e!==null&&e.getDate()?jQuery.datepicker.formatDate(o.dateFormat,e):""}function m(){p.data("state")==="closed"&&(b(),p.fadeIn(300).data("state","open"),o.onOpen&&o.onOpen())}function g(){p.data("state")==="open"&&(p.fadeOut(300).data("state","closed"),o.onClose&&o.onClose())}function y(){p.data("state")==="open"?g():m()}function b(){var t=N||n,r=t.offset(),i="left",s=r.left,o=e(window).width()-s-t.outerWidth();s>o&&(i="right",s=o),p.parent().css(i,s).css("top",r.top+t.outerHeight())}function w(e,t,n,r){var i=t.find(".range-start"),s=t.find(".range-end");return r.hide(),e.is(".ui-daterangepicker-specificDate")?(n.show(),t.find(".title-start").text(o.presets.specificDate),i.restoreDateFromData().css("opacity",1).show(400),s.restoreDateFromData().css("opacity",0).hide(400),setTimeout(function(){r.fadeIn()},400)):e.is(".ui-daterangepicker-allDatesBefore")?(n.show(),t.find(".title-end").text(o.presets.allDatesBefore),i.saveDateToData().css("opacity",0).hide(400),s.restoreDateFromData().css("opacity",1).show(400),o.earliestDate&&i.datepicker("setDate",o.earliestDate),setTimeout(function(){r.fadeIn()},400)):e.is(".ui-daterangepicker-allDatesAfter")?(n.show(),t.find(".title-start").text(o.presets.allDatesAfter),i.restoreDateFromData().css("opacity",1).show(400),s.saveDateToData().css("opacity",0).hide(400),o.latestDate&&s.datepicker("setDate",o.latestDate),setTimeout(function(){r.fadeIn()},400)):e.is(".ui-daterangepicker-dateRange")?(n.show(),t.find(".title-start").text(o.rangeStartTitle),t.find(".title-end").text(o.rangeEndTitle),i.restoreDateFromData().datepicker("refresh").css("opacity",1).show(400),s.restoreDateFromData().datepicker("refresh").css("opacity",1).show(400),setTimeout(function(){r.fadeIn()},400)):(t.find(".range-start, .range-end").css("opacity",0).hide(400,function(){n.hide()}),i.datepicker("setDate",e.data("dateStart")),s.datepicker("setDate",e.data("dateEnd")),t.find(".ui-datepicker-current-day a").trigger("click")),!1}var n=e(this),r=new Date,i=Date.parse("today"),s=function(e){switch(typeof e){case"string":return Date.parse(e);case"function":return e()}return e},o=jQuery.extend({presetRanges:[{text:"Today",dateStart:i,dateEnd:i},{text:"Last 7 days",dateStart:"today-7days",dateEnd:i},{text:"This month",dateStart:new Date(r.getFullYear(),r.getMonth(),1),dateEnd:"today"}],presets:{dateRange:"Date Range"},rangeStartTitle:"Start date",rangeEndTitle:"End date",nextLinkText:"Next",prevLinkText:"Prev",doneButtonText:"Done",earliestDate:!1,latestDate:!1,constrainDates:!1,rangeSplitter:" - ",dateFormat:e.datepicker.ISO_8601,closeOnSelect:!0,arrows:!1,appendTo:"body",onClose:!1,onOpen:!1,onChange:!1,datepickerOptions:null},t),u={onSelect:function(t,r){e(this).trigger("constrainOtherPicker");var i=p.find(".range-start").datepicker("getDate"),s=p.find(".range-end").datepicker("getDate"),u=v(i),a=v(s);p.find(".ui-daterangepicker-specificDate").is(".ui-state-active")&&(a=u),n.length===2?(n.eq(0).val(u),n.eq(1).val(a)):n.val(u!==a?u+o.rangeSplitter+a:u),n.data("daterange",{start:i,end:s}),o.closeOnSelect&&!p.find("li.ui-state-active").is(".ui-daterangepicker-dateRange")&&!p.is(":animated")&&g(),n.trigger("change")},defaultDate:0};o.onChange&&n.bind("change",o.onChange),o.datepickerOptions=t?jQuery.extend(u,t.datepickerOptions):u;var a,f=i,l,c;if(n.size()===2)l=Date.parse(n.eq(0).val()),c=Date.parse(n.eq(1).val()),l===null&&(l=c),c===null&&(c=l);else{var h=n.val().split(o.rangeSplitter);l=Date.parse(h[0]),c=Date.parse(h[1]),c===null&&(c=l)}l!==null&&(a=l),c!==null&&(f=c);var p=e('<div class="ui-daterangepicker ui-widget ui-helper-clearfix ui-widget-content ui-corner-all"></div>'),d=function(){var t=e('<ul class="ui-widget-content"></ul>').appendTo(p);jQuery.each(o.presetRanges,function(){this.dateStart=s(this.dateStart),this.dateEnd=s(this.dateEnd),e('<li class="ui-daterangepicker-'+this.text.replace(/ /g,"")+' ui-corner-all"><a href="#">'+this.text+"</a></li>").data("dateStart",this.dateStart).data("dateEnd",this.dateEnd).appendTo(t)});var n=0;return jQuery.each(o.presets,function(r,i){e('<li class="ui-daterangepicker-'+r+" preset_"+n+' ui-helper-clearfix ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span><a href="#">'+i+"</a></li>").appendTo(t),n++}),t.find("li").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).click(function(){return p.find(".ui-state-active").removeClass("ui-state-active"),e(this).addClass("ui-state-active"),w(e(this),p,E,S),!1}),t}();jQuery.fn.restoreDateFromData=function(){var t=e(this);return t.data("saveDate")&&t.datepicker("setDate",t.data("saveDate")).removeData("saveDate"),this},jQuery.fn.saveDateToData=function(){var t=e(this);return t.data("saveDate")||t.data("saveDate",t.datepicker("getDate")),this};var E=e('<div class="ranges ui-widget-header ui-corner-all ui-helper-clearfix"><div class="range-start"><span class="title-start">Start Date</span></div><div class="range-end"><span class="title-end">End Date</span></div></div>').appendTo(p);E.find(".range-start, .range-end").datepicker(o.datepickerOptions),E.find(".range-start").datepicker("setDate",a),E.find(".range-end").datepicker("setDate",f),E.find(".range-start, .range-end").bind("constrainOtherPicker",function(){o.constrainDates&&(e(this).is(".range-start")?p.find(".range-end").datepicker("option","minDate",e(this).datepicker("getDate")):p.find(".range-start").datepicker("option","maxDate",e(this).datepicker("getDate")))}).trigger("constrainOtherPicker");var S=e('<button class="btnDone ui-state-default ui-corner-all">'+o.doneButtonText+"</button>").click(function(){p.find(".ui-datepicker-current-day").trigger("click"),g()}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).appendTo(E);e(this).click(function(){return y(),!1}),E.hide().find(".range-start, .range-end, .btnDone").hide(),p.data("state","closed"),E.find(".ui-datepicker").css("display","block"),e(o.appendTo).append(p),p.wrap('<div class="ui-daterangepickercontain"></div>');if(o.arrows&&n.size()===1){var x=e('<a href="#" class="ui-daterangepicker-prev ui-corner-all" title="'+o.prevLinkText+'"><span class="ui-icon ui-icon-circle-triangle-w">'+o.prevLinkText+"</span></a>"),T=e('<a href="#" class="ui-daterangepicker-next ui-corner-all" title="'+o.nextLinkText+'"><span class="ui-icon ui-icon-circle-triangle-e">'+o.nextLinkText+"</span></a>");e(this).addClass("ui-rangepicker-input ui-widget-content").wrap('<div class="ui-daterangepicker-arrows ui-widget ui-widget-header ui-helper-clearfix ui-corner-all"></div>').before(x).before(T).parent().find("a").click(function(){var t=E.find(".range-start").datepicker("getDate"),n=E.find(".range-end").datepicker("getDate"),r=Math.abs((new TimeSpan(t-n)).getTotalMilliseconds())+864e5;return e(this).is(".ui-daterangepicker-prev")&&(r=-r),E.find(".range-start, .range-end ").each(function(){var t=e(this).datepicker("getDate");if(t===null)return!1;e(this).datepicker("setDate",t.add({milliseconds:r})).find(".ui-datepicker-current-day").trigger("click")}),!1}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});var N=n.parent()}return e(document).click(function(){p.is(":visible")&&g()}),p.click(function(){return!1}).hide(),this};jQuery.fn.daterangepicker=t})(jQuery);
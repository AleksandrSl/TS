<!-- REFERENCE -->
<div id="ws-4" class="workflow-step " style="display: none;">
    <div class="workflow-step-content">
        <table class="plan-grid">
            <tr>
                <td>
                    <p class="form-label">Reference Library:</p>
                    <select id="library" name="library" class="select-group">

                    <option value=""></option>

                    {% if selectedApplProductData %}
                        {% for ref in planTemplateData.references %}
                            {% ifequal ref.short_name selectedApplProductData.reference %}
                                <option SELECTED value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                            {% else %}
                                {% ifequal ref.name selectedApplProductData.reference %}
                                    <option SELECTED value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                                {% else %}
                                    <option value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedApplProductData.reference not in planTemplateData.referenceShortNames %}
                            <option SELECTED class="entryNotFound" value="{{selectedApplProductData.reference}}" style="color: -moz-linear-gradient(top, #d91a1a 0%, #d91a1a 50%, #ca1818 51%, #ca1818 100%);">{{selectedApplProductData.reference}}</option>
                        {% endif %}
                    {% else %}
                        {% for ref in planTemplateData.references %}
                            {% ifequal ref.short_name selectedPlanTemplate.library %}
                                <option SELECTED value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                            {% else %}
                                {% ifequal ref.name selectedPlanTemplate.library %}
                                    <option SELECTED value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                                {% else %}
                                    <option value="{{ref.short_name}}">{{ref.short_name}}({{ref.name}})</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedPlanTemplate.library %}
                            {% if selectedPlanTemplate.library not in planTemplateData.referenceShortNames %}
                                <option SELECTED class="entryNotFound" value="{{selectedPlanTemplate.library}}">(Not Found) {{selectedPlanTemplate.library}}</option>
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="form-label">Target Regions BED File:</p>
                    <select id="bedfile" name="bedfile" class="select-group">
                    <option value=""></option>

                    {% if selectedApplProductData %}
                        {% for bedFile in planTemplateData.bedFiles %}
                            {% ifequal bedFile.path selectedApplProductData.targetBedFile %}
                                <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                            {% else %}
                                {% ifequal bedFile.file selectedPlanTemplate.bedfile %}
                                    <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% else %}
                                    <option value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedApplProductData.targetBedFile %}
                            {% if selectedApplProductData.targetBedFile not in planTemplateData.bedFileFullPaths and selectedApplProductData.targetBedFile not in planTemplateData.bedFilePaths %}
                                <option SELECTED value="{{selectedApplProductData.targetBedFile}}">(Not Found) {{selectedApplProductData.targetBedFile}}</option>
                            {% endif %}
                        {% endif %}

                    {% else %}
                        {% for bedFile in planTemplateData.bedFiles %}
                            {% ifequal bedFile.path selectedPlanTemplate.bedfile %}
                                <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                            {% else %}
                                {% ifequal bedFile.file selectedPlanTemplate.bedfile %}
                                    <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% else %}
                                    <option value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedPlanTemplate.bedfile %}
                            {% if selectedPlanTemplate.bedfile not in planTemplateData.bedFileFullPaths and selectedPlanTemplate.bedfile not in planTemplateData.bedFilePaths %}
                                <option SELECTED value="{{selectedPlanTemplate.bedfile}}" class="{{bedFile.meta.reference}}">(Not Found) {{selectedPlanTemplate.bedfile}}</option>
                            {% endif %}
                        {% endif %}

                    {% endif %}
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                	<div class="hotspot_bed_file_section">
                    <p class="form-label">Hotspot Regions BED File:</p>
                    <select id="regionfile" name="regionfile" class="select-group">
                    <option value=""></option>

                    {% if selectedApplProductData %}
                        {% for bedFile in planTemplateData.hotspotFiles %}
                            {% ifequal bedFile.path selectedApplProductData.hotSpotBedFile %}
                                <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                            {% else %}
                                {% ifequal bedFile.file selectedPlanTemplate.regionfile %}
                                    <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% else %}
                                    <option value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedApplProductData.hotSpotBedFile %}
                            {% if selectedApplProductData.hotSpotBedFile not in planTemplateData.hotspotFullPaths and selectedApplProductData.hotSpotBedFile not in planTemplateData.hotspotPaths%}
                                <option SELECTED value="{{selectedApplProductData.hotSpotBedFile}}" class="{{bedFile.meta.reference}}">(Not Found) {{selectedApplProductData.hotSpotBedFile}}</option>
                            {% endif %}
                        {% endif %}

                    {% else %}
                        {% for bedFile in planTemplateData.hotspotFiles %}
                            {% ifequal bedFile.path selectedPlanTemplate.regionfile %}
                                <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                            {% else %}
                                {% ifequal bedFile.file selectedPlanTemplate.regionfile %}
                                    <option SELECTED value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% else %}
                                    <option value="{{bedFile.file}}" class="{{bedFile.meta.reference}}">{{bedFile.path}}</option>
                                {% endifequal %}
                            {% endifequal %}
                        {% endfor %}

                        {% if selectedPlanTemplate.regionfile %}
                            {% if selectedPlanTemplate.regionfile not in planTemplateData.hotspotFullPaths and selectedPlanTemplate.regionfile not in planTemplateData.hotspotPaths%}
                                <option SELECTED value="{{selectedPlanTemplate.regionfile}}" class="{{bedFile.meta.reference}}" style="color: -moz-linear-gradient(top, #d91a1a 0%, #d91a1a 50%, #ca1818 51%, #ca1818 100%);">(Not Found) {{selectedPlanTemplate.regionfile}}</option>
                            {% endif %}
                        {% endif %}

                    {% endif %}

                    </select>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>